generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  name          String?
  password      String
  role          Role     @default(EDITOR)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  assignedLeads Lead[]   @relation("LeadAssignedTo")
}

model Market {
  id                String    @id @default(uuid())
  code              String    @unique
  labelPt           String
  labelEn           String
  heroMessagePt     String?
  heroMessageEn     String?
  priority          Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  heroMessageEs     String?
  heroMessageFr     String?
  labelEs           String?
  labelFr           String?
  highlightProjects Project[]
}

model Media {
  id               String         @id @default(uuid())
  type             MediaType      @default(IMAGE)
  originalUrl      String
  thumbnailUrl     String?
  mediumUrl        String?
  largeUrl         String?
  webpUrl          String?
  avifUrl          String?
  width            Int?
  height           Int?
  sizeBytes        Int?
  durationSeconds  Int?
  format           String?
  contentType      String?
  altPt            String?
  altEn            String?
  altEs            String?
  altFr            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  projectHero      Project?
  projectGalleries ProjectMedia[]
  pageHeroBackgrounds Page[]      @relation("PageHeroBackground")
  pageDemoreelVideos  Page[]      @relation("PageDemoreelVideo")
}

model Tag {
  id        String      @id @default(uuid())
  slug      String      @unique
  labelPt   String
  labelEn   String
  labelEs   String?
  labelFr   String?
  category  TagCategory
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  projects  Project[]   @relation("ProjectToTag")
}

model Service {
  id            String        @id @default(uuid())
  slug          String        @unique
  titlePt       String
  titleEn       String
  titleEs       String?
  titleFr       String?
  descriptionPt String?
  descriptionEn String?
  descriptionEs String?
  descriptionFr String?
  icon          String?
  status        ServiceStatus @default(PUBLISHED)
  priority      Int           @default(0)
  segments      String[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  projects      Project[]     @relation("ProjectToService")
}

model Project {
  id            String               @id @default(uuid())
  slug          String               @unique
  title         String
  shortTitle    String?
  summaryPt     String?
  summaryEn     String?
  summaryEs     String?
  summaryFr     String?
  city          String?
  stateProvince String?
  country       String?
  year          Int?
  client        String?
  type          String?
  featured      Boolean              @default(false)
  priorityHome  Int                  @default(0)
  status        ProjectStatus        @default(DRAFT)
  ctaLabelPt    String?
  ctaLabelEn    String?
  ctaUrl        String?
  heroImageId   String?              @unique
  marketId      String?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  descriptionEn String?
  descriptionEs String?
  descriptionFr String?
  descriptionPt String?
  pageViews     PageView[]
  heroImage     Media?               @relation(fields: [heroImageId], references: [id])
  market        Market?              @relation(fields: [marketId], references: [id])
  interactions  ProjectInteraction[]
  gallery       ProjectMedia[]
  services      Service[]            @relation("ProjectToService")
  tags          Tag[]                @relation("ProjectToTag")
  sections      Section[]            @relation("SectionProjects")
}

model Page {
  id                     String     @id @default(uuid())
  name                   String
  slug                   String     @unique
  seoTitlePt             String?
  seoTitleEn             String?
  seoDescPt              String?
  seoDescEn              String?
  status                 PageStatus @default(PUBLISHED)
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  heroSloganPt           String?
  heroSloganEn           String?
  heroSloganEs           String?
  heroSloganFr           String?
  heroSubtitleEn         String?
  heroSubtitleEs         String?
  heroSubtitleFr         String?
  heroSubtitlePt         String?
  seoDescEs              String?
  seoDescFr              String?
  seoTitleEs             String?
  seoTitleFr             String?
  pillar1Pt              String?
  pillar1En              String?
  pillar1Es              String?
  pillar1Fr              String?
  pillar2Pt              String?
  pillar2En              String?
  pillar2Es              String?
  pillar2Fr              String?
  pillar3Pt              String?
  pillar3En              String?
  pillar3Es              String?
  pillar3Fr              String?
  // Hero Media - Sistema HÃ­brido (Media OU URL manual)
  heroBackgroundImageId  String?
  heroBackgroundImageUrl String?
  demoreelVideoId        String?
  demoreelVideoUrl       String?
  heroBackgroundImage    Media?     @relation("PageHeroBackground", fields: [heroBackgroundImageId], references: [id])
  demoreelVideo          Media?     @relation("PageDemoreelVideo", fields: [demoreelVideoId], references: [id])
  sections               Section[]
}

model Section {
  id             String    @id @default(uuid())
  pageId         String
  order          Int       @default(0)
  type           String
  layout         String?
  titlePt        String?
  titleEn        String?
  titleEs        String?
  titleFr        String?
  bodyPt         String?
  bodyEn         String?
  bodyEs         String?
  bodyFr         String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  page           Page      @relation(fields: [pageId], references: [id])
  linkedProjects Project[] @relation("SectionProjects")
}

model ProjectMedia {
  id        String   @id @default(uuid())
  projectId String
  mediaId   String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  media     Media    @relation(fields: [mediaId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, mediaId])
  @@index([projectId, order])
}

model VisitorSession {
  sessionId           String               @id
  ipAddress           String?
  userAgent           String?
  language            String?
  country             String?
  region              String?
  city                String?
  duration            Int                  @default(0)
  lastActivityAt      DateTime             @default(now())
  leadId              String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  interestScore       InterestScore?
  pageViews           PageView[]
  projectInteractions ProjectInteraction[]
  lead                Lead?                @relation(fields: [leadId], references: [id])
}

model PageView {
  id          String         @id @default(uuid())
  sessionId   String
  pageSlug    String?
  projectSlug String?
  projectId   String?
  timeSpent   Int            @default(0)
  scrollDepth Int            @default(0)
  viewedAt    DateTime       @default(now())
  project     Project?       @relation(fields: [projectId], references: [id])
  session     VisitorSession @relation(fields: [sessionId], references: [sessionId])
}

model ProjectInteraction {
  id        String                 @id @default(uuid())
  sessionId String
  projectId String
  type      ProjectInteractionType @default(VIEW)
  metadata  Json
  createdAt DateTime               @default(now())
  project   Project                @relation(fields: [projectId], references: [id])
  session   VisitorSession         @relation(fields: [sessionId], references: [sessionId])
}

model InterestScore {
  sessionId           String         @id
  museumScore         Int            @default(0)
  brandScore          Int            @default(0)
  festivalScore       Int            @default(0)
  cityScore           Int            @default(0)
  educationScore      Int            @default(0)
  researchScore       Int            @default(0)
  vrScore             Int            @default(0)
  aiScore             Int            @default(0)
  installationScore   Int            @default(0)
  conversionScore     Int            @default(0)
  visitorType         String?
  recommendedProjects Json?
  suggestedAction     String?
  suggestedPage       String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  session             VisitorSession @relation(fields: [sessionId], references: [sessionId])
}

model Lead {
  id            String           @id @default(uuid())
  name          String
  email         String
  phone         String?
  company       String?
  position      String?
  leadType      LeadType         @default(CONTACT_FORM)
  projectType   String?
  budget        String?
  timeline      String?
  description   String?
  sourceUrl     String?
  referrer      String?
  utmSource     String?
  utmMedium     String?
  utmCampaign   String?
  status        LeadStatus       @default(NEW)
  priority      LeadPriority     @default(MEDIUM)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  assignedToId  String?
  assignedAt    DateTime?
  notes         String?
  lastContactAt DateTime?
  assignedTo    User?            @relation("LeadAssignedTo", fields: [assignedToId], references: [id])
  editalLeads   LeadEdital[]
  sessions      VisitorSession[]

  @@index([status])
  @@index([priority])
  @@index([assignedToId])
  @@index([createdAt])
}

model Edital {
  id                  String       @id @default(uuid())
  name                String
  source              String
  sourceUrl           String
  country             String
  type                EditalType
  area                String
  categories          String[]
  minValue            Float?
  maxValue            Float?
  currency            String       @default("BRL")
  deadline            DateTime?
  applicationDeadline DateTime?
  status              EditalStatus @default(ABERTO)
  eligibility         String?
  applicationSteps    String?
  requiredDocs        String[]
  description         String?
  requirements        String?
  relevanceScore      Int          @default(0)
  matchedServices     String[]
  matchedProjects     String[]
  azimutFitNotes      String?
  contactEmail        String?
  contactName         String?
  contactPhone        String?
  contactLinkedIn     String?
  scrapedAt           DateTime     @default(now())
  lastChecked         DateTime?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  leads               LeadEdital[]

  @@index([status])
  @@index([deadline])
  @@index([country])
  @@index([relevanceScore])
  @@index([source])
}

model LeadEdital {
  id              String           @id @default(uuid())
  editalId        String
  leadId          String
  emailSent       Boolean          @default(false)
  emailSentAt     DateTime?
  callScheduled   Boolean          @default(false)
  callScheduledAt DateTime?
  callLink        String?
  portfolioSent   Boolean          @default(false)
  portfolioSentAt DateTime?
  proposalSent    Boolean          @default(false)
  proposalSentAt  DateTime?
  status          LeadEditalStatus @default(PENDING)
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  edital          Edital           @relation(fields: [editalId], references: [id], onDelete: Cascade)
  lead            Lead             @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@unique([editalId, leadId])
  @@index([status])
}

model Settings {
  id                     String   @id @default("singleton")
  siteName               String?  @default("Azimut")
  siteUrl                String?  @default("https://azmt.com.br")
  contactEmail           String?
  contactPhone           String?
  defaultMetaDescription String?
  defaultKeywords        String?
  ogImageUrl             String?
  facebookUrl            String?
  instagramUrl           String?
  linkedinUrl            String?
  twitterUrl             String?
  youtubeUrl             String?
  kabbamApiKey           String?
  kabbamApiUrl           String?
  smtpHost               String?
  smtpPort               Int?
  smtpUser               String?
  smtpPassword           String?
  smtpFromEmail          String?
  deepseekApiKey         String?
  notificationEmail      String?
  defaultLanguage        String?  @default("pt")
  defaultCountry         String?  @default("BR")
  timezone               String?  @default("America/Sao_Paulo")
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

enum Role {
  SUPER_ADMIN
  ADMIN
  EDITOR
  VIEWER
}

enum TagCategory {
  TECHNOLOGY
  INDUSTRY
  FORMAT
  OTHER
}

enum ServiceStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ProjectStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LeadType {
  CONTACT_FORM
  BUDGET_INQUIRY
}

enum LeadPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum LeadStatus {
  NEW
  IN_PROGRESS
  WON
  LOST
  CONTACTED
  PROPOSAL_SENT
  NEGOTIATION
}

enum EditalType {
  FEDERAL
  ESTADUAL
  MUNICIPAL
  PRIVADO
  ONG
  INSTITUTO
  PROVINCIAL
  NATIONAL
}

enum EditalStatus {
  ABERTO
  FECHADO
  ENVIADO
  GANHO
  PERDIDO
}

enum LeadEditalStatus {
  PENDING
  CONTACTED
  EMAIL_SENT
  CALL_SCHEDULED
  PROPOSAL_SENT
  WON
  LOST
}

enum MediaType {
  IMAGE
  VIDEO
}

enum ProjectInteractionType {
  VIEW
  CLICK
  LIKE
  SHARE
  CTA
}
